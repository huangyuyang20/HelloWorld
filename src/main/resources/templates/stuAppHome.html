<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>入学申请</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="../assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="../assets/css/amazeui.min.css" />
    <link rel="stylesheet" href="../assets/css/admin.css">
    <link rel="stylesheet" href="../assets/css/app.css">
</head>

<body data-type="generalComponents">
<%@ include file="leftNav.jsp" %>


<header class="am-topbar am-topbar-inverse admin-header">
    <div class="am-topbar-brand">
        <a href="javascript:" class="tpl-logo">
            <img src="../assets/img/logo.png" alt="">
        </a>
    </div>
    <div class="am-icon-list tpl-header-nav-hover-ico am-fl am-margin-right">

    </div>
    <!--
    <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#topbar-collapse'}">
        <span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span>
    </button>
    -->
    <div class="am-collapse am-topbar-collapse" id="topbar-collapse">

        <ul class="am-nav am-nav-pills am-topbar-nav am-topbar-right admin-header-list tpl-header-list">
            <li class="am-hide-sm-only"><a href="javascript:;" id="admin-fullscreen" class="tpl-header-list-link"><span class="am-icon-arrows-alt"></span> <span class="admin-fullText">开启全屏</span></a></li>
            <li class="am-dropdown" data-am-dropdown data-am-dropdown-toggle>
                <a class="am-dropdown-toggle tpl-header-list-link" href="javascript:;">
                    <span class="tpl-header-list-user-nick" id="user_center">
                        <span class="tpl-header-list-user-nick"  sec:authentication="name">
                    </span><span class="tpl-header-list-user-ico"> <img src="../assets/img/user01.png"></span>
                    </span>
                </a>
                <ul class="am-dropdown-content">
                    <li><a href="/student/application"><span class="am-icon-bell-o"></span>填写表格/Fill Forms</a></li>
                    <li><a href="/student/appstatus"><span class="am-icon-cog"></span>申请状态查询/Application Status</a></li>
                    <li><a href="/index"><span class="am-icon-power-off"></span> 退出/Exit</a></li>
                </ul>
            </li>
            <!--<li><a href="###" class="tpl-header-list-link"><span class="am-icon-sign-out tpl-header-list-ico-out-size"></span></a></li>-->
        </ul>
    </div>
</header>


<div class="tpl-page-container tpl-page-header-fixed">



    <div class="tpl-content-wrapper">
        <div class="tpl-content-page-title">
            入学申请人-申请 Applicants-Application
        </div>
        <!--
        <ol class="am-breadcrumb">
            <li><a href="#" class="am-icon-home">首页</a></li>
            <li><a href="#">表单</a></li>
            <li class="am-active">Amaze UI 表单</li>
        </ol>
        -->
        <div class="tpl-portlet-components">
            <div class="portlet-title">
                <div class="caption font-green bold">
                    <span class="am-icon-code"></span> Form #A02
                </div>
                <!--
                <div class="tpl-portlet-input tpl-fz-ml">
                    <div class="portlet-input input-small input-inline">
                        <div class="input-icon right">
                            <i class="am-icon-search"></i>
                            <input type="text" class="form-control form-control-solid" placeholder="搜索..."> </div>
                    </div>
                </div>
                -->


            </div>


            <div class="tpl-block">

                <div class="am-g">
                    <div class="tpl-form-body tpl-form-line">
                        <form class="am-form tpl-form-line-form">

                            <div class="am-form-group">
                                <label  class="am-u-sm-3 am-form-label">申请编号/Application No.</label>
                                <div class="am-u-sm-9">
                                    <span id="id" ></span>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label  class="am-u-sm-3 am-form-label">姓名/Name</label>
                                <div class="am-u-sm-9">
                                    <span id="name"></span>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label class="am-u-sm-3 am-form-label">性别/Gender</label>
                                <div class="am-u-sm-9" id ="gender">
                                    <label class="am-radio-inline">
                                        <input type="radio"  value="male" name="group_gender"> 男/Male
                                    </label>
                                    <label class="am-radio-inline">
                                        <input type="radio" value="female" name="group_gender"> 女/Female
                                    </label>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label class="am-u-sm-3 am-form-label">E-mail</label>
                                <div class="am-u-sm-9">
                                    <input type="email" id="email" placeholder="Email">
                                    <small>优先使用教育邮箱/Educational email first</small>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label  class="am-u-sm-3 am-form-label">证件类型/Type of Identical Document</label>
                                <div class="am-u-sm-9">
                                    <span id="id_type" >中国大陆身份证</span>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label  class="am-u-sm-3 am-form-label">证件号码/Identical Document Number</label>
                                <div class="am-u-sm-9">
                                    <span id="id_no"></span>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label for="phone" class="am-u-sm-3 am-form-label">电话/Telephone</label>
                                <div class="am-u-sm-9">
                                    <input type="tel" id="phone" placeholder="Telephone">
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label class="am-u-sm-3 am-form-label">出生日期/Birthdate</label>
                                <div class="am-u-sm-9">
                                    <input type="text" class="am-form-field" id="birthdate" data-am-datepicker readonly required />
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label class="am-u-sm-3 am-form-label">出生地/Birthplace</label>
                                <div class="am-u-sm-9">
                                    <input type="text" id="birthplace" placeholder="Birthplace">
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label class="am-u-sm-3 am-form-label">考试分数</label>
                                <div class="am-u-sm-9">
                                    <input type="text" id="undergraduate" placeholder="考试分数">
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label class="am-u-sm-3 am-form-label">申请专业/Major to Apply</label>
                                <div class="am-u-sm-9">
                                    <select id = "major">
                                        <option value="cs">计算机科学/Computer Science</option>
                                        <option value="xx">玄学/xx</option>
                                    </select>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label for="address" class="am-u-sm-3 am-form-label">通讯地址/Postal Address</label>
                                <div class="am-u-sm-9">
                                    <input type="text" id="address" placeholder="Postal Address">
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label for="user_intro" class="am-u-sm-3 am-form-label">个人说明/Personal Statement</label>
                                <div class="am-u-sm-9">
                                    <textarea class="" rows="5" id="user_intro" placeholder="Personal Statement"></textarea>
                                    <small>Introduce yourself with no more than 500 words/用不超过500词介绍自己</small>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <div class="am-u-sm-9 am-u-sm-push-3">
                                    <button type="button" class="am-btn am-btn-primary" onclick="save()">保存/Save</button>

                                    <button type="button" class="am-btn am-btn-danger" onclick="saveAndSubmit()">提交/Submit</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<script src="../js/jquery.min.js"></script>
<script src="../js/amazeui.min.js"></script>
<script src="../js/app.js"></script>
<script>
    $(function () {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");
        $.ajax({
            type:"GET",
            url:"/student/application/init",
            beforeSend: function(request) {
                request.setRequestHeader(header, token); // 添加  CSRF Token
            },
            success:function(data){
                console.log(data.studApplyInformation.stuApplyId + ' ' + data.studApplyInformation.stuName + ' ' + data.studApplyInformation.stuEmail);
                $('#id').text(data.studApplyInformation.stuApplyId);
                $('#name').text(data.studApplyInformation.stuName);
                $('#email').val(data.studApplyInformation.stuEmail);
                $('#id_no').text(data.studApplyInformation.stuIdCard);
                $('#phone').val(data.studApplyInformation.stuPhone);
                $("#birthplace").val(data.studApplyInformation.stuBirthplace);
                $('#undergraduate').val(data.studApplyInformation.stuGrade);
                $('#address').val(data.studApplyInformation.stuBirthplace);
                $('#major').val(data.studApplyInformation.stuMajor);
                $("#user_intro").val(data.studApplyInformation.stuIntroduction);
            },
            error:function(){
                alert("发生错误");
            }
        });
    });
</script>
<script>
    function save() {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        var id = $('#id').text();
        var name = $('#name').text();
        var email = $('#email').val();
        var id_no = $('#id_no').val();
        var phone = $('#phone').val();

        var undergraduate = $('#undergraduate').val();
        var address =  $('#address').val();
        var user_intro = $('#user_intro').val();

        var major =  document.getElementById('major').value;
        var birthdate = $('#birthdate').val();

        var gender = $("input[type='radio']:checked").val();
        var data ={
            stuGender:gender,
            stuEmail:email,
            stuPhone:phone,
            stuGrade:undergraduate,
            stuBirthplace:address,
            stuIntroduction:user_intro,
            stuMajor:major,
            stuApplyId:id,
            stuBirthday:birthdate
        };
        console.log(JSON.stringify(data));
        $.ajax({
            type:"POST",
            url:"/student/application/edit",
            dataType:"json",
            contentType: "application/json;charset=UTF-8",
            data:JSON.stringify(data),
            beforeSend: function(request) {
                request.setRequestHeader(header, token); // 添加  CSRF Token
            },
            success:function(data){
                if(data.status =="success"){
                    alert("Save successfully!");
                    window.location.href = "/student/application";
                }
                else{
                    alert("发生错误");
                }

            },
            error:function(){
                alert("发生错误");
            }
        })
    }

    function saveAndSubmit() {
        save();
    }


</script>
</body>

</html>
