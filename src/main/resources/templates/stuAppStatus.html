<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Students Application-SCU</title>

    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="../assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="../assets/css/amazeui.min.css" />
    <link rel="stylesheet" href="../assets/css/admin.css">
    <link rel="stylesheet" href="../assets/css/app.css">
</head>

<body data-type="generalComponents">
<!--<%@ include file="leftNav.jsp" %>-->

<header class="am-topbar am-topbar-inverse admin-header">
    <div class="am-topbar-brand">
        <a href="javascript:" class="tpl-logo">
            <img src="../assets/img/logo.png" alt="">
        </a>
    </div>
    <div class="am-icon-list tpl-header-nav-hover-ico am-fl am-margin-right">

    </div>
    <!--
    <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#topbar-collapse'}">
        <span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span>
    </button>
    -->
    <div class="am-collapse am-topbar-collapse" id="topbar-collapse">

        <ul class="am-nav am-nav-pills am-topbar-nav am-topbar-right admin-header-list tpl-header-list">
            <li class="am-hide-sm-only"><a href="javascript:;" id="admin-fullscreen" class="tpl-header-list-link"><span class="am-icon-arrows-alt"></span> <span class="admin-fullText">开启全屏</span></a></li>
            <li class="am-dropdown" data-am-dropdown data-am-dropdown-toggle>
                <a class="am-dropdown-toggle tpl-header-list-link" href="javascript:;">
                    <span class="tpl-header-list-user-nick">Username</span><span class="tpl-header-list-user-ico"> <img src="../assets/img/user01.png"></span>
                </a>
                <ul class="am-dropdown-content">
                    <li><a href="#"><span class="am-icon-bell-o"></span>填写表格/Fill Forms</a></li>
                    <li><a href="#"><span class="am-icon-cog"></span>申请状态查询/Application Status</a></li>
                    <li><a href="../html/signin.jsp"><span class="am-icon-power-off"></span> 退出/Exit</a></li>
                </ul>
            </li>
            <li><a href="###" class="tpl-header-list-link"><span class="am-icon-sign-out tpl-header-list-ico-out-size"></span></a></li>
        </ul>
    </div>
</header>


<div class="tpl-page-container tpl-page-header-fixed">


    <div class="tpl-content-wrapper">
        <div class="tpl-content-page-title">
            Application-Status 申请-状态
        </div>
        <!--
        <div class="tpl-content-scope">
            <div class="note note-info">
                <h3>Explanation 说明
                    <span class="close" data-close="note"></span>
                </h3>
                <p><span class="label label-danger"></span>Please check your application status at any time.请随时查询你的申请状态。</p>

            </div>
        </div>
        -->
        <div class="row">
            <div class="am-u-lg-3 am-u-md-6 am-u-sm-12">
                <div class="dashboard-stat blue">
                    <div class="visual">
                        <i class="am-icon-comments-o"></i>
                    </div>
                    <div class="details">
                        <div class="number"> SUBMITTED </div>
                        <div class="desc"> 材料状态 </div>
                    </div>
                </div>
            </div>
            <div id="status1">
            </div>
            <div id="status2">
            </div>
            <div id="status3">
            </div>
        </div>
    </div>
    <div class="tpl-content-wrapper" id = "admission-confim">
    </div>

</div>


<script src="../js/jquery.min.js"></script>
<script src="../js/amazeui.min.js"></script>
<script src="../js/app.js"></script>
<script>
    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");
    $(function () {
        var appInfo = sessionStorage.getItem('appInfo');
        console.log(appInfo);
        appInfo= JSON.parse(appInfo);

        $.ajax({
            url: '/applyForColleage/getSelfState',
            type: 'POST',
            dataType: 'text',
            data: {
                "userId": appInfo.body
            },
            async: false,//是否异步请求
            beforeSend: function(request) {
                request.setRequestHeader(header, token); // 添加  CSRF Token
            },
            success: function (data) {
                //如果请求成功，返回数据。
                if (data.status === "fail") {
                    alert(data.msg);
                }
                else {
                    var json= JSON.stringify(data);
                    // document.getElementById("id_no").innerText=data;
                    // document.getElementById("major").innerText=?

                    if (data > 1){
                        var htm1 = "<div class=\"am-u-lg-3 am-u-md-6 am-u-sm-12\" >\n" +
                            "                <div class=\"dashboard-stat red\">\n" +
                            "                    <div class=\"visual\">\n" +
                            "                        <i class=\"am-icon-bar-chart-o\"></i>\n" +
                            "                    </div>\n" +
                            "                    <div class=\"details\">\n" +
                            "                        <div class=\"number\"> PASS </div>\n" +
                            "                        <div class=\"desc\"> 初审 </div>\n" +
                            "                    </div>\n" +
                            "\n" +
                            "                </div>\n" +
                            "            </div>";
                        $('#status1').append(htm1);
                    }
                    if (data > 2){
                        var htm2 = "<div class=\"am-u-lg-3 am-u-md-6 am-u-sm-12\" >\n" +
                            "                <div class=\"dashboard-stat green\">\n" +
                            "                    <div class=\"visual\">\n" +
                            "                        <i class=\"am-icon-apple\"></i>\n" +
                            "                    </div>\n" +
                            "                    <div class=\"details\">\n" +
                            "                        <div class=\"number\"> PASS </div>\n" +
                            "                        <div class=\"desc\"> 复审 </div>\n" +
                            "                    </div>\n" +
                            "                </div>\n" +
                            "            </div>";
                        $('#status2').append(htm2);
                    }
                    if (data > 3){
                        var htm3 = "<div class=\"am-u-lg-3 am-u-md-6 am-u-sm-12\">\n" +
                            "                <div class=\"dashboard-stat purple\">\n" +
                            "                    <div class=\"visual\">\n" +
                            "                        <i class=\"am-icon-android\"></i>\n" +
                            "                    </div>\n" +
                            "                    <div class=\"details\">\n" +
                            "                        <div class=\"number\"> PASS </div>\n" +
                            "                        <div class=\"desc\"> 终审 </div>\n" +
                            "                    </div>\n" +
                            "                </div>\n" +
                            "            </div>";
                        $('#status3').append(htm3);
                    }

                    if(data == 4){
                        var html="<div class=\"tpl-content-page-title\">\n" +
                            "            Admission Confirmation  录取信息确认\n" +
                            "        </div>\n" +
                            "        <div class=\"tpl-portlet-components\">\n" +
                            "            <div class=\"portlet-title\">\n" +
                            "                <div class=\"caption font-green bold\">\n" +
                            "                    <span class=\"am-icon-code\"></span> 确认表/Form #A03\n" +
                            "                </div>\n" +
                            "            </div>\n" +
                            "\n" +
                            "            <div class=\"tpl-block\">\n" +
                            "                <div class=\"am-g\">\n" +
                            "                    <div class=\"tpl-form-body tpl-form-line\">\n" +
                            "                        <form class=\"am-form tpl-form-line-form\">\n" +
                            "                            <div class=\"am-form-group\">\n" +
                            "                                <label  class=\"am-u-sm-3 am-form-label\" id=\"major\">专业/Major</label>\n" +
                            "                                <div class=\"am-u-sm-9\">\n" +
                            "                                    <span id=\"stu_app_major\" >computer science</span>\n" +
                            "                                </div>\n" +
                            "                            </div>\n" +
                            "\n" +
                            "                            <div class=\"am-form-group\">\n" +
                            "                                <label  class=\"am-u-sm-3 am-form-label\" id=\"stu_no\">学号/Student No.</label>\n" +
                            "                                <div class=\"am-u-sm-9\">\n" +
                            "                                    <span id=\"stu_id\" >2016141462240</span>\n" +
                            "                                </div>\n" +
                            "                            </div>\n" +
                            "\n" +
                            "                            <div class=\"am-form-group\">\n" +
                            "                                <label class=\"am-u-sm-3 am-form-label\" id = >选择/Option</label>\n" +
                            "                                <div class=\"am-u-sm-9\">\n" +
                            "                                    <select data-am-selected=\"{searchBox: 1}\" id = \"option\">\n" +
                            "                                        <option value=\"1\">接受/Accept</option>\n" +
                            "                                        <option value=\"2\">拒绝/Refuse</option>\n" +
                            "                                    </select>\n" +
                            "                                </div>\n" +
                            "                            </div>\n" +
                            "\n" +
                            "                            <div class=\"am-form-group\">\n" +
                            "                                <label  class=\"am-u-sm-3 am-form-label\">说明/Explanation</label>\n" +
                            "                                <div class=\"am-u-sm-9\">\n" +
                            "                                    <textarea class=\"\" rows=\"3\" id=\"user-intro\" placeholder=\"Explanation\" id = \"exp\"></textarea>\n" +
                            "                                    <small>Fill the blank if you refuse this offer /当拒绝录取时填写</small>\n" +
                            "                                </div>\n" +
                            "                            </div>\n" +
                            "\n" +
                            "                            <div class=\"am-form-group\">\n" +
                            "                                <div class=\"am-u-sm-9 am-u-sm-push-3\">\n" +
                            "                                    <button type=\"button\" class=\"am-btn am-btn-primary tpl-btn-bg-color-success \" onclick=\"saveAndSubmit()\">提交</button>\n" +
                            "                                </div>\n" +
                            "                            </div>\n" +
                            "                        </form>\n" +
                            "                    </div>\n" +
                            "                </div>\n" +
                            "            </div>\n" +
                            "\n" +
                            "\n" +
                            "        </div>";
                        console.log("#admission-confim");
                        $("#admission-confim").append(html);
                    }

                    if (data == 5){
                        console.log("asdasd")
                        $("#admission-confim").append("欢迎加入");
                    }

                    if (data == -1){
                        $("#admission-confim").append("未通过");
                    }

                    if (data == -2){
                        $("#admission-confim").append("已拒绝");
                    }
                }

            },
            error: function (XMLHttpRequrest, textStatus) {
                alert(XMLHttpRequest.status);
                alert(XMLHttpRequest.readyState);
                alert(textStatus);
            }
        })
    });
    function saveAndSubmit() {
        var stuSelfcheck = 1;
        console.log();
        if (document.getElementById('option').value != 1){
            console.log(stuSelfcheck);
            stuSelfcheck = -1;
        }
        var appInfo = sessionStorage.getItem('appInfo');
        appInfo= JSON.parse(appInfo);
        $.ajax({
            type: 'POST',
            url: '/applyForColleage/studnetMakesure',
            contentType: "application/json;charset=UTF-8",
            data: JSON.stringify({
                stuSelfcheck: stuSelfcheck,
                userId: appInfo.body
            }),
            beforeSend: function(request) {
                request.setRequestHeader(header, token); // 添加  CSRF Token
            },
            success:function(data){
                console.log(data);
                window.location.href = "/student/appstatus";
            },
            error: function(data){
                console.log("失败");
            }


        });
    }

    function admission_confirm() {

        var username = $('#username')[0].value;
        var name = $('#name')[0].value;
        var password = $('#password')[0].value;
        var id = $('#id')[0].value;
        if(name.length==0||id.length==0||username.length==0||password.length== 0){
            alert("请输入正确的账号和密码!");
        }
        else{
            var user = {
                username: username,     //账号
                password: password,     //密码
                userRole: "ROLE_STUDENT"
            };
            var student = {
                stuName: name,
                stuIdCard: id
            };
            var model = {
                user: user,
                studApplyInformation: student
            };
            $.ajax({
                type:'POST',
                url:'/login/register',
                dataType:"json",
                contentType: "application/json;charset=UTF-8",
                data:JSON.stringify(model),
                beforeSend: function(request) {
                    request.setRequestHeader(header, token); // 添加  CSRF Token
                },
                success:function(data){
                    console.log(data);
                    if(data.status === "fail"){
                        alert("注册失败!请重新注册!");
                    }else{
                        window.location.href = "/";
                    }
                },
                error: function(data){
                    console.log("失败");
                }

            })
        }
    }
</script>
</body>

</html>
